{% extends "base.html" %}
{% block content %}

<div class="card" style="max-width: 900px;">

    <h1>{{ city.capitalize() }} â€“ EvoluÈ›ie meteo & locaÈ›ie</h1>

    <div style="
        margin: 20px 0;
        padding: 18px;
        border-radius: 16px;
        background: rgba(255,255,255,0.06);
        text-align: center;
        font-size: 0.95em;
        opacity: 0.9;
    ">
        ğŸŒAstÄƒzi Ã®n <strong>{{ city.capitalize() }}</strong>:
        temperaturi Ã®ntre <strong>{{ daily_min[0] | round(1) }}Â°C</strong> È™i <strong>{{ daily_max[0] | round(1) }}Â°C</strong>,
vÃ¢nt de <strong>{{ weather.wind_kph | round(1) }} km/h</strong>
È™i umiditate <strong>{{ weather.humidity }}%</strong>.

    </div>

    <div class="chart-card">
        <h3>ğŸŒ¡ï¸ TemperaturÄƒ (Â°C)</h3>
        <canvas id="tempChart"></canvas>
    </div>

    <div class="grid">

    <div class="stat-item">
        <i class="fas fa-wind"></i>
        <h3>{{ weather.wind_kph }} km/h</h3>
        <p>VÃ¢nt</p>
    </div>

    <div class="stat-item">
        <i class="fas fa-tint"></i>
        <h3>{{ weather.humidity }}%</h3>
        <p>Umiditate</p>
    </div>

    <div class="stat-item">
        <i class="fas fa-sun"></i>
        <h3>{{ weather.uv }}</h3>
        <p>{{ uv_advice }}</p>
    </div>

    <div class="stat-item">
        <i class="fas fa-thermometer-half"></i>
        <h3>{{ weather.feels_like | default(weather.temperature) }} Â°C</h3>
        <p>ResimÈ›itÄƒ</p>
    </div>

    <div class="stat-item">
        <i class="fas fa-compress-arrows-alt"></i>
        <h3>{{ weather.pressure_mb | default("â€”") }} hPa</h3>
        <p>Presiune</p>
    </div>


</div>


    <div style="
        margin-top: 30px;
        border-radius: 20px;
        overflow: hidden;
        height: 350px;
        border: 1px solid var(--primary);
    ">
        <iframe
            width="100%"
            height="100%"
            frameborder="0"
            src="https://maps.google.com/maps?q={{ city }}&z=10&output=embed">
        </iframe>
    </div>

    <div style="margin-top: 35px; display: grid; gap: 30px;">

        <div class="chart-card">
            <h3>ğŸ’¨ VÃ¢nt (km/h)</h3>
            <canvas id="windChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>ğŸ’§ Umiditate (%)</h3>
            <canvas id="humidityChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>â˜” PrecipitaÈ›ii (mm)</h3>
            <canvas id="precipChart"></canvas>
        </div>

    </div>

    <div style="margin-top: 30px;">
        <a href="/" class="btn">Ãnapoi la Home</a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const labels = {{ hour_labels | tojson }};
const nowIndex = labels.length - 1;


new Chart(document.getElementById('tempChart'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [
            {
                label: 'TemperaturÄƒ Â°C',
                data: {{ hourly_temps | tojson }},
                borderColor: '#00d2ff',
                backgroundColor: 'rgba(0,210,255,0.25)',
                fill: true,
                tension: 0.4,
                pointRadius: labels.map((_, i) => i === nowIndex ? 6 : 3),
                pointBackgroundColor: labels.map((_, i) => i === nowIndex ? '#fff' : '#00d2ff')
            },
            {
                label: 'ResimÈ›itÄƒ Â°C',
                data: {{ hourly_feelslike | tojson }},   
                borderColor: '#ffae42',
                backgroundColor: 'rgba(255,174,66,0.25)',
                fill: true,
                tension: 0.4,
                pointRadius: labels.map((_, i) => i === nowIndex ? 6 : 3),
                pointBackgroundColor: labels.map((_, i) => i === nowIndex ? '#fff' : '#ffae42')
            }
        ]
    },
    options: {
        plugins: { legend: { labels: { color: 'white' } } },
        scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
        }
    }
});


new Chart(document.getElementById('windChart'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'VÃ¢nt km/h',
            data: {{ hourly_wind | tojson }},
            borderColor: '#7CFFB2',
            tension: 0.4,
            fill: false
        }]
    },
    options: {
        plugins: { legend: { labels: { color: 'white' } } },
        scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
        }
    }
});


new Chart(document.getElementById('humidityChart'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Umiditate %',
            data: {{ hourly_humidity | tojson }},
            borderColor: '#b388ff',
            tension: 0.4,
            fill: false
        }]
    },
    options: {
        plugins: { legend: { labels: { color: 'white' } } },
        scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
        }
    }
});

new Chart(document.getElementById('precipChart'), {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'PrecipitaÈ›ii mm',
            data: {{ hourly_precip | tojson }},
            backgroundColor: '#1a73e8'
        }]
    },
    options: {
        plugins: { legend: { labels: { color: 'white' } } },
        scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
        }
    }
});
</script>




<script>
window.addEventListener('scroll', () => {
    document.querySelectorAll('.card, .chart-card, .grid').forEach(el => {
        const top = el.getBoundingClientRect().top;
        if(top < window.innerHeight - 100) el.classList.add('visible');
    });
});
</script>

{% endblock %}
